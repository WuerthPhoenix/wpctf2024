#!/usr/bin/env python3

import random
import string
import time
import xml.etree.ElementTree as ET

from pwn import *

request_template = """\
<metric>
    <keypress>{}</keypress>
    <timestamp>{}</timestamp>
</metric>\x00"""

p = remote("127.0.0.1", 25565)
FLAG_LEN = 29

flag = []
index = 0
while len(flag) < FLAG_LEN:
    char = random.choice(string.ascii_letters)
    req = request_template.format(char, time.time())
    p.send(req.encode())

    response = p.recvuntil(b"\x00").decode().strip("\x00")
    index += 1
    log.info(response)

    if "Success" in response:
        root = ET.fromstring(response)
        flag_char = root.find("transactionId").text

        flag.append((index, flag_char))
        index = 0

actual_flag = "".join(c for _, c in sorted(flag))
log.success(actual_flag)
